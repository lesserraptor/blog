# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

# Sample workflow for building and deploying a Jekyll site to GitHub Pages
name: Deploy Jekyll site to Pages

on:
  # Runs on pushes targeting the default branch
  push:
    branches: ["main"]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# Allow only one concurrent deployment, skipping runs queued between the run in-progress and latest queued.
# However, do NOT cancel in-progress runs as we want to allow these production deployments to complete.
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  # Build job
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setup Ruby
        # https://github.com/ruby/setup-ruby/releases/tag/v1.207.0
        uses: ruby/setup-ruby@4a9ddd6f338a97768b8006bf671dfbad383215f4
        with:
          ruby-version: '3.1' # Not needed with a .ruby-version file
          bundler-cache: true # runs 'bundle install' and caches installed gems automatically
          cache-version: 0 # Increment this number if you need to re-download cached gems
      # - name: Setup Pages
      #  id: pages
      #  uses: actions/configure-pages@v5
      - name: Build with Jekyll
        # Outputs to the './_site' directory by default
        run: bundle exec jekyll build 
        # --baseurl "${{ steps.pages.outputs.base_path }}"
        env:
          JEKYLL_ENV: production
      # - name: Upload artifact
        # Automatically uploads an artifact from the './_site' directory by default
       # uses: actions/upload-pages-artifact@v3
     - name: Deploy to neocities
       uses: bcomnes/deploy-to-neocities@v3
       with:
         api_key: ${{ secrets.NEOCITIES_API_TOKEN }}
         cleanup: false
         neocities_supporter: false # set this to true if you have a supporter account and want to bypass unsuported files filter.
         preview_before_deploy: true # print a deployment plan prior to waiting for files to upload.
         dist_dir: _site
        
  # Deployment job
  #deploy:
   # runs-on: ubuntu-latest

    #steps:
    # The checkout step copies your repo into the action runner. Important!
    #- uses: actions/checkout@v4
    # Set up any tools and build steps here
    # This example uses a Node.js toolchain to build a site
    # If you don't need Node.js to build your site, you can omit this.
    #- name: Use Node.js
    #  uses: actions/setup-node@v4
    #  with:
    #    node-version: lts/*
    # If you have a different build process, replace this with your own build steps
    #- name: Install deps and build
    #  run: |
    #    npm i
    #    npm run build
    # When the dist_dir is ready, deploy it to neocities
    # Here we deploy the folder named `public`
    #- name: Deploy to neocities
    #  uses: bcomnes/deploy-to-neocities@v3
     # with:
      #  api_key: ${{ secrets.NEOCITIES_API_TOKEN }}
       # cleanup: false
        #neocities_supporter: false # set this to true if you have a supporter account and want to bypass unsuported files filter.
        #preview_before_deploy: true # print a deployment plan prior to waiting for files to upload.
        #dist_dir: _site
